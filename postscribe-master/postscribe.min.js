!function(){function t(){}function e(t){return t!==l&&null!==t}function r(t){return"function"==typeof t}function n(t,e,r){var n,i=t&&t.length||0;for(n=0;i>n;n++)e.call(r,t[n],n)}function i(t,e,r){var n;for(n in t)t.hasOwnProperty(n)&&e.call(r,n,t[n])}function o(t,e){return i(e,function(e,r){t[e]=r}),t}function s(t,r){return t=t||{},i(r,function(r,n){e(t[r])||(t[r]=n)}),t}function a(t){try{return d.call(t)}catch(e){var r=[];return n(t,function(t){r.push(t)}),r}}function c(t){return t&&"tagName"in t?!!~t.tagName.toLowerCase().indexOf("script"):!1}function u(t){return t&&"tagName"in t?!!~t.tagName.toLowerCase().indexOf("style"):!1}var p={afterAsync:t,afterDequeue:t,afterStreamStart:t,afterWrite:t,beforeEnqueue:t,beforeWriteToken:function(t){return t},beforeWrite:function(t){return t},done:t,error:function(t){throw t},releaseAsync:!1},h=this,l=void 0;if(!h.postscribe){var f=!1,d=Array.prototype.slice,y=function(t){return t[t.length-1]},m=function(){function t(t,r,n){var i=p+r;if(2===arguments.length){var o=t.getAttribute(i);return e(o)?String(o):o}e(n)&&""!==n?t.setAttribute(i,n):t.removeAttribute(i)}function s(e,r){var n=e.ownerDocument;o(this,{root:e,options:r,win:n.defaultView||n.parentWindow,doc:n,parser:htmlParser("",{autoFix:!0}),actuals:[e],proxyHistory:"",proxyRoot:n.createElement(e.nodeName),scriptStack:[],writeQueue:[]}),t(this.proxyRoot,"proxyof",0)}var p="data-ps-";return s.prototype.write=function(){[].push.apply(this.writeQueue,arguments);for(var t;!this.deferredRemote&&this.writeQueue.length;)t=this.writeQueue.shift(),r(t)?this.callFunction(t):this.writeImpl(t)},s.prototype.callFunction=function(t){var e={type:"function",value:t.name||t.toString()};this.onScriptStart(e),t.call(this.win,this.doc),this.onScriptDone(e)},s.prototype.writeImpl=function(t){this.parser.append(t);for(var e,r,n,i=[];(e=this.parser.readToken())&&!(r=c(e))&&!(n=u(e));)e=this.options.beforeWriteToken(e),e&&i.push(e);this.writeStaticTokens(i),r&&this.handleScriptToken(e),n&&this.handleStyleToken(e)},s.prototype.writeStaticTokens=function(t){var e=this.buildChunk(t);if(e.actual)return e.html=this.proxyHistory+e.actual,this.proxyHistory+=e.proxy,this.proxyRoot.innerHTML=e.html,f&&(e.proxyInnerHTML=this.proxyRoot.innerHTML),this.walkChunk(),f&&(e.actualInnerHTML=this.root.innerHTML),e},s.prototype.buildChunk=function(t){var e=this.actuals.length,r=[],i=[],o=[];return n(t,function(t){var n=htmlParser.tokenToString(t);if(r.push(n),t.attrs){if(!/^noscript$/i.test(t.tagName)){var s=e++;i.push(n.replace(/(\/?>)/," "+p+"id="+s+" $1")),"ps-script"!==t.attrs.id&&"ps-style"!==t.attrs.id&&o.push("atomicTag"===t.type?"":"<"+t.tagName+" "+p+"proxyof="+s+(t.unary?" />":">"))}}else i.push(n),o.push("endTag"===t.type?n:"")}),{tokens:t,raw:r.join(""),actual:i.join(""),proxy:o.join("")}},s.prototype.walkChunk=function(){for(var r,n=[this.proxyRoot];e(r=n.shift());){var i=1===r.nodeType,o=i&&t(r,"proxyof");if(!o){i&&(this.actuals[t(r,"id")]=r,t(r,"id",null));var s=r.parentNode&&t(r.parentNode,"proxyof");s&&this.actuals[s].appendChild(r)}n.unshift.apply(n,a(r.childNodes))}},s.prototype.handleScriptToken=function(t){var e=this.parser.clear();if(e&&this.writeQueue.unshift(e),t.src=t.attrs.src||t.attrs.SRC,t=this.options.beforeWriteToken(t)){t.src&&this.scriptStack.length?this.deferredRemote=t:this.onScriptStart(t);var r=this;this.writeScriptToken(t,function(){r.onScriptDone(t)})}},s.prototype.handleStyleToken=function(t){var e=this.parser.clear();e&&this.writeQueue.unshift(e),t.type=t.attrs.type||t.attrs.TYPE||"text/css",t=this.options.beforeWriteToken(t),t&&this.writeStyleToken(t),e&&this.write()},s.prototype.writeStyleToken=function(t){var e=this.buildStyle(t);this.insertStyle(e),t.content&&(e.styleSheet&&!e.sheet?e.styleSheet.cssText=t.content:e.appendChild(this.doc.createTextNode(t.content)))},s.prototype.buildStyle=function(t){var e=this.doc.createElement(t.tagName);return e.setAttribute("type",t.type),i(t.attrs,function(t,r){e.setAttribute(t,r)}),e},s.prototype.insertStyle=function(t){this.writeImpl('<span id="ps-style"/>');var e=this.doc.getElementById("ps-style");e.parentNode.replaceChild(t,e)},s.prototype.onScriptStart=function(t){t.outerWrites=this.writeQueue,this.writeQueue=[],this.scriptStack.unshift(t)},s.prototype.onScriptDone=function(t){return t!==this.scriptStack[0]?void this.options.error({message:"Bad script nesting or script finished twice"}):(this.scriptStack.shift(),this.write.apply(this,t.outerWrites),void(!this.scriptStack.length&&this.deferredRemote&&(this.onScriptStart(this.deferredRemote),this.deferredRemote=null)))},s.prototype.writeScriptToken=function(t,e){var r=this.buildScript(t),n=this.shouldRelease(r),i=this.options.afterAsync;t.src&&(r.src=t.src,this.scriptLoadHandler(r,n?i:function(){e(),i()}));try{this.insertScript(r),(!t.src||n)&&e()}catch(o){this.options.error(o),e()}},s.prototype.buildScript=function(t){var e=this.doc.createElement(t.tagName);return i(t.attrs,function(t,r){e.setAttribute(t,r)}),t.content&&(e.text=t.content),e},s.prototype.insertScript=function(t){this.writeImpl('<span id="ps-script"/>');var e=this.doc.getElementById("ps-script");e.parentNode.replaceChild(t,e)},s.prototype.scriptLoadHandler=function(t,e){function r(){t=t.onload=t.onreadystatechange=t.onerror=null}function n(){r(),e()}function i(t){r(),s(t),e()}var s=this.options.error;o(t,{onload:function(){n()},onreadystatechange:function(){/^(loaded|complete)$/.test(t.readyState)&&n()},onerror:function(){i({message:"remote script failed "+t.src})}})},s.prototype.shouldRelease=function(t){var e=/^script$/i.test(t.nodeName);return!e||!!(this.options.releaseAsync&&t.src&&t.hasAttribute("async"))},s}();h.postscribe=function(){function e(){var t,e=u.shift();e&&(t=y(e),t.afterDequeue(),e.stream=n.apply(null,e),t.afterStreamStart())}function n(r,n,s){function u(t){t=s.beforeWrite(t),l.write(t),s.afterWrite(t)}l=new m(r,s),l.id=c++,l.name=s.name||l.id,i.streams[l.name]=l;var p=r.ownerDocument,h={close:p.close,open:p.open,write:p.write,writeln:p.writeln};o(p,{close:t,open:t,write:function(){return u(a(arguments).join(""))},writeln:function(){return u(a(arguments).join("")+"\n")}});var f=l.win.onerror||t;return l.win.onerror=function(t,e,r){s.error({msg:t+" - "+e+":"+r}),f.apply(l.win,arguments)},l.write(n,function(){o(p,h),l.win.onerror=f,s.done(),l=null,e()}),l}function i(n,i,o){r(o)&&(o={done:o}),o=s(o,p),n=/^#/.test(n)?h.document.getElementById(n.substr(1)):n.jquery?n[0]:n;var a=[n,i,o];return n.postscribe={cancel:function(){a.stream?a.stream.abort():a[1]=t}},o.beforeEnqueue(a),u.push(a),l||e(),n.postscribe}var c=0,u=[],l=null;return o(i,{streams:{},queue:u,WriteStream:m})}()}}();